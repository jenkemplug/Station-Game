<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Derelict Station ‚Äî Expanded Idle</title>
  <link rel="stylesheet" href="styles.css?v=0.9.9">
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Derelict Station ‚Äî Expanded Survival</h1>
      <div style="font-size:12px;color:var(--muted)">You hold a sealed base on a ruined station. Manage survivors, craft gear, face alien threats.</div>
    </div>
    <div class="flex-row">
      <div id="timePlayed" class="small">‚Äî</div>
      <button id="btnSave">Save</button>
      <button id="btnExport">Export</button>
      <button id="btnImport">Import</button>
      <input type="file" id="importFile" accept="application/json" style="display:none" />
      <button id="btnReset" class="danger">Reset</button>
    </div>
  </header>

    <main class="main-col">
    <div class="top-panels">
      <div class="panel" style="flex:1;">
        <strong style="color:var(--accent)">Base</strong>
        <div class="small">Sealed room. Keep systems online.</div>
        <div style="margin-top:8px" class="resources">
          <div class="res-item">
            <b id="res-oxygen">O‚ÇÇ: 0</b>
            <div id="res-oxygen-rate" class="stat">‚Äî/s</div>
            <div id="res-oxygen-consume" class="stat-consume">‚Äî/s</div>
          </div>
          <div class="res-item">
            <b id="res-food">Food: 0</b>
            <div id="res-food-rate" class="stat">‚Äî/s</div>
            <div id="res-food-consume" class="stat-consume">‚Äî/s</div>
          </div>
          <div class="res-item">
            <b id="res-energy">Energy: 0</b>
            <div id="res-energy-rate" class="stat">‚Äî/s</div>
            <div id="res-energy-consume" class="stat-consume">‚Äî/s</div>
          </div>
          <div class="res-item">
            <b id="res-scrap">Scrap: 0</b>
            <div id="res-scrap-rate" class="stat">‚Äî/s</div>
          </div>
        </div>
        <div class="base-controls">
          <button id="btnAssign" class="primary">Recruit</button>
          <button id="btnExpedition">Expedition</button>
          <div id="expeditionSurvivorDropdown" class="base-controls-dropdown"></div>
        </div>
      </div>
      <div class="panel" style="width:340px;">
        <strong>Systems</strong>
        <div class="small" style="margin-top:6px">Upgrade base systems to improve production and defense.</div>
        <div style="margin-top:10px">
          <div class="stat-block"><div>O‚ÇÇ Filter</div><div id="sys-filter">Level 0</div></div>
          <div class="stat-block"><div>Generator</div><div id="sys-generator">Level 0</div></div>
          <div class="stat-block"><div>Turrets</div><div id="sys-turret">Offline</div></div>
          <div style="display:flex;gap:6px;margin-top:48px;justify-content:center">
            <button id="btnUpgradeFilter">Upgrade Filter</button>
            <button id="btnUpgradeGen">Upgrade Generator</button>
            <button id="btnBuildTurret">Build Turret</button>
          </div>
          <div id="systemRepairs" style="margin-top:8px;display:none">
            <div class="small" style="color:var(--danger);margin-bottom:6px">‚ö†Ô∏è Failed systems require repair:</div>
            <div style="display:flex;gap:6px;flex-wrap:wrap">
              <button id="btnRepairFilter" style="display:none">Repair Filter</button>
              <button id="btnRepairGenerator" style="display:none">Repair Generator</button>
              <button id="btnRepairTurret" style="display:none">Repair Turret</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
        <strong style="color:var(--accent)">Station Map</strong>
        <div id="explorerDropdown" style="width:180px;"></div>
      </div>
      <div class="small" style="margin-top:6px">Explore to find loot, survivors, alien nests, and modules.</div>
      <div class="map" id="mapGrid" style="margin-top:10px"></div>
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
        <div id="mapInfo" class="small">Explored: 0 ‚Ä¢ Click highlighted tiles to explore</div>
      </div>
    </div>
    <div class="bottom-panels">
      <div class="panel" style="flex:1;">
        <strong class="small">Workbench</strong>
        <div id="workbench" style="margin-top:6px;display:flex;flex-direction:column;gap:6px">
          <!-- Buttons dynamically rendered by renderWorkbench() in ui.js -->
        </div>
      </div>
      <!-- This space intentionally left blank -->
      <div id="threatBasePanel" class="panel" style="flex:1;">
        <strong style="color:var(--accent)">Threats & Base</strong>
        <div class="small" style="margin-top:6px">Manage guard duty and defenses.</div>
        <div style="margin-top:8px">
          <div id="baseIntegritySection" style="margin-bottom:8px;">
            <div style="display:flex;justify-content:space-between;">
              <span>Base Integrity:</span>
              <span id="baseIntegrity" style="font-weight:bold;">100%</span>
            </div>
            <div style="width:100%;height:12px;background:#333;border-radius:6px;margin-top:4px;box-shadow:inset 0 2px 4px rgba(0,0,0,0.3);">
              <div id="baseIntegrityBar" style="width:100%;height:100%;background:#4ade80;transition:width 0.3s, background 0.3s;border-radius:6px;"></div>
            </div>
            <button id="btnRepairBase" style="margin-top:6px;font-size:12px;padding:4px 8px;width:100%;">Repair Base</button>
          </div>
          <div class="stats-grid">
            <div>Threat: <span id="threatLevel">Low</span></div>
            <div id="escalationRow" style="display:none;color:#ff6b6b;font-weight:bold">
              Escalation Level: <span id="escalationLevel">0</span>
            </div>
            <div>Raid Chance (per min): <span id="raidChance">0%</span></div>
            <div id="raidCooldownRow" class="small" style="display:none;">Cooldown: <span id="raidCooldown">--:--</span></div>
            <div>Aliens Killed: <span id="alienKills">0</span></div>
            <div>Active Guards: <span id="activeGuards">0</span></div>
            <div>Total Survivors: <span id="totalSurvivors">0</span></div>
            <div>Active Expeditions: <span id="activeExpeditions">0</span></div>
            <div>Inventory: <span id="inventoryUsage">0/20</span></div>
            <div>Explored Tiles: <span id="exploredTiles">0</span></div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <aside class="side-col">
    <div class="panel">
      <strong style="color:var(--accent)">Notifications</strong>
      <div class="log" id="log" style="margin-top:8px;max-height:150px"></div>
    </div>
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong style="color:var(--accent)">Survivors</strong><div class="small">Manage skills & assignments</div></div>
        <div id="survivorCount" class="small">0</div>
      </div>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:8px 0;">
      <div id="survivorList"></div>
    </div>
    <div class="panel">
      <div style="flex-shrink:0;">
        <strong style="color:var(--accent)">Inventory</strong> <span id="inventoryCapacity" class="small" style="color:var(--muted)"></span>
      </div>
      <div class="inventory scrollable-panel" id="inventory" style="margin-top:8px;max-height:320px;overflow-y:auto;"></div>
      <div style="flex-shrink:0;">
        <div style="margin-top:8px" class="small">Tech: <span id="statTech">0</span> ‚Ä¢ Ammo: <span id="statAmmo">0</span></div>
        <div style="margin-top:10px">
          <button id="btnRepairItems">Repair Equipment</button>
          <button id="btnAutoSalvage">Salvage Junk</button>
          <button id="btnRecycleAll">Recycle All Items</button>
        </div>
      </div>
    </div>
  </aside>

  <footer>
    <div>Version 0.9.9</div>
    <div>Autosave every 15s ‚Ä¢ Offline progress supported ‚Ä¢ Press Ctrl+D for debug panel</div>
  </footer>
</div>

<!-- Debug Panel -->
<div id="debugPanel" class="debug-panel" style="display:none;">
  <div class="debug-content">
    <div class="debug-header">
      <h2>üõ†Ô∏è Debug Panel</h2>
      <button id="btnCloseDebug" class="debug-close">‚úï Close</button>
    </div>
    
    <div class="debug-body">
    
    <div class="debug-section">
      <h3>üí∞ Resources</h3>
      <div class="debug-grid">
        <button onclick="debugAddResource('oxygen', 100)">+100 Oxygen</button>
        <button onclick="debugAddResource('food', 100)">+100 Food</button>
        <button onclick="debugAddResource('energy', 100)">+100 Energy</button>
        <button onclick="debugAddResource('scrap', 100)">+100 Scrap</button>
        <button onclick="debugAddResource('tech', 10)">+10 Tech</button>
        <button onclick="debugAddResource('ammo', 50)">+50 Ammo</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>üè≠ Systems & Base</h3>
      <div class="debug-grid">
        <button onclick="debugUpgradeSystems()">Upgrade All Systems</button>
        <button onclick="debugResetThreat()">Reset Threat</button>
        <button onclick="debugRaiseThreat()">Raise Threat (+10%)</button>
        <button onclick="debugLockThreat()">Lock Threat (100%)</button>
        <button onclick="debugRaiseEscalation()">Raise Escalation (+1)</button>
        <button onclick="debugResetRaidChance()">Reset Raid Chance</button>
        <button onclick="debugRaiseRaidChance()">Raise Raid Chance (+1%)</button>
        <button onclick="debugRepairBase()">Repair Base (100%)</button>
        <button onclick="debugTriggerRaid()">Trigger Raid</button>
        <button onclick="debugFailSystem('filter')">Fail Filter</button>
        <button onclick="debugFailSystem('generator')">Fail Generator</button>
        <button onclick="debugFailSystem('turret')">Fail Turret</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>üíä Consumables & Components</h3>
      
      <h4>‚öóÔ∏è Consumables</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('medkit')">Medkit</button>
        <button onclick="debugAddItem('advanced_medkit')">Advanced Medkit</button>
        <button onclick="debugAddItem('stimpack')">Stimpack</button>
        <button onclick="debugAddItem('repair_kit')">Repair Kit</button>
        <button onclick="debugAddItem('combat_drug')">Combat Drug</button>
        <button onclick="debugAddItem('stun_grenade')">Stun Grenade</button>
        <button onclick="debugAddItem('nanite_injector')">Nanite Injector</button>
        <button onclick="debugAddItem('revival_kit')">Revival Kit</button>
        <button onclick="debugAddItem('system_override')">System Override</button>
        <button onclick="debugAddItem('stealth_field')">Stealth Field</button>
      </div>
      
      <h4>üîß Components</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('weaponPart')">Weapon Part</button>
        <button onclick="debugAddItem('electronics')">Electronics</button>
        <button onclick="debugAddItem('armor_plating')">Armor Plating</button>
        <button onclick="debugAddItem('power_core')">Power Core</button>
        <button onclick="debugAddItem('nano_material')">Nano-Material</button>
        <button onclick="debugAddItem('advanced_component')">Advanced Component</button>
        <button onclick="debugAddItem('quantum_core')">Quantum Core</button>
        <button onclick="debugAddItem('alien_artifact')">Alien Artifact</button>
      </div>
      
      <h4>üé® Rarity Colors</h4>
      <div style="display:flex;gap:8px;flex-wrap:wrap;padding:8px;background:rgba(0,0,0,0.2);border-radius:4px">
        <span style="color:var(--rarity-common)">Common</span>
        <span style="color:var(--rarity-uncommon)">Uncommon</span>
        <span style="color:var(--rarity-rare)">Rare</span>
        <span style="color:var(--rarity-legendary)">LEGENDARY</span>
      </div>
    </div>

    <div class="debug-section">
      <h3>üë• Survivor Management</h3>
      <div class="debug-grid">
        <button onclick="debugRecruitSurvivor()">Recruit Survivor (Free)</button>
        <button onclick="debugHealAll()">Heal All Survivors</button>
        <button onclick="debugMaxMorale()">Max All Morale</button>
        <button onclick="debugLevelupAll()">Level Up All Survivors</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>üó∫Ô∏è Map & Exploration</h3>
      <div class="debug-grid">
        <button onclick="debugRevealMap()">Reveal All Tiles</button>
        <button onclick="debugSpawnAliens()">Spawn Aliens (Random)</button>
        <button onclick="debugClearAliens()">Clear All Aliens</button>
        <button onclick="debugAddHazards()">Add Hazard Rooms</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>‚è±Ô∏è Time Control</h3>
      <div class="debug-grid">
        <button onclick="debugSkipTime(60)">Skip 1 Minute</button>
        <button onclick="debugSkipTime(300)">Skip 5 Minutes</button>
        <button onclick="debugSkipTime(3600)">Skip 1 Hour</button>
      </div>
    </div>
    
    <div class="debug-section weapons-armor-section">
      <h3>‚öîÔ∏è Weapons & Armor</h3>
      
      <h4>üî™ Melee Weapons</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('makeshift_pipe')">Makeshift Pipe</button>
        <button onclick="debugAddItem('sharpened_tool')">Sharpened Tool</button>
        <button onclick="debugAddItem('crowbar')">Crowbar</button>
        <button onclick="debugAddItem('combat_knife')">Combat Knife</button>
        <button onclick="debugAddItem('stun_baton')">Stun Baton</button>
        <button onclick="debugAddItem('reinforced_bat')">Reinforced Bat</button>
        <button onclick="debugAddItem('plasma_blade')">Plasma Blade</button>
        <button onclick="debugAddItem('shock_maul')">Shock Maul</button>
        <button onclick="debugAddItem('nano_edge_katana')">Nano-Edge Katana</button>
      </div>
      
      <h4>üî´ Pistols</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('scrap_pistol')">Scrap Pistol</button>
        <button onclick="debugAddItem('old_revolver')">Old Revolver</button>
        <button onclick="debugAddItem('laser_pistol')">Laser Pistol</button>
        <button onclick="debugAddItem('heavy_pistol')">Heavy Pistol</button>
        <button onclick="debugAddItem('plasma_pistol')">Plasma Pistol</button>
        <button onclick="debugAddItem('smart_pistol')">Smart Pistol</button>
        <button onclick="debugAddItem('void_pistol')">Void Pistol</button>
      </div>
      
      <h4>üéØ Rifles</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('assault_rifle')">Assault Rifle</button>
        <button onclick="debugAddItem('scoped_rifle')">Scoped Rifle</button>
        <button onclick="debugAddItem('pulse_rifle')">Pulse Rifle</button>
        <button onclick="debugAddItem('plasma_rifle')">Plasma Rifle</button>
        <button onclick="debugAddItem('gauss_rifle')">Gauss Rifle</button>
        <button onclick="debugAddItem('quantum_rifle')">Quantum Rifle</button>
      </div>
      
      <h4>üí• Shotguns</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('pump_shotgun')">Pump Shotgun</button>
        <button onclick="debugAddItem('combat_shotgun')">Combat Shotgun</button>
        <button onclick="debugAddItem('plasma_shotgun')">Plasma Shotgun</button>
        <button onclick="debugAddItem('disintegrator_cannon')">Disintegrator</button>
      </div>
      
      <h4>üî• Heavy Weapons</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('light_machine_gun')">LMG</button>
        <button onclick="debugAddItem('grenade_launcher')">Grenade Launcher</button>
        <button onclick="debugAddItem('minigun')">Minigun</button>
        <button onclick="debugAddItem('railgun')">Railgun</button>
      </div>
      
      <h4>üõ°Ô∏è Light Armor</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('scrap_vest')">Scrap Vest</button>
        <button onclick="debugAddItem('padded_suit')">Padded Suit</button>
        <button onclick="debugAddItem('light_armor')">Light Armor</button>
        <button onclick="debugAddItem('tactical_vest')">Tactical Vest</button>
        <button onclick="debugAddItem('reinforced_plating')">Reinforced Plating</button>
        <button onclick="debugAddItem('composite_armor')">Composite Armor</button>
        <button onclick="debugAddItem('stealth_suit')">Stealth Suit</button>
        <button onclick="debugAddItem('power_armor_frame')">Power Armor Frame</button>
        <button onclick="debugAddItem('thermal_suit')">Thermal Suit</button>
        <button onclick="debugAddItem('nano_weave_armor')">Nano-Weave</button>
        <button onclick="debugAddItem('shield_suit')">Shield Suit</button>
        <button onclick="debugAddItem('regenerative_armor')">Regenerative Armor</button>
      </div>
      
      <h4>üõ°Ô∏è Heavy Armor</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('heavy_armor')">Heavy Armor</button>
        <button onclick="debugAddItem('titan_armor')">Titan Armor</button>
        <button onclick="debugAddItem('void_suit')">Void Suit</button>
      </div>
      
      <h4>‚ò£Ô∏è Hazmat Suits</h4>
      <div class="debug-grid">
        <button onclick="debugAddItem('hazmat_suit')">Hazmat Suit</button>
      </div>
    </div>
    
    </div> <!-- End debug-body -->
  </div> <!-- End debug-content -->
</div> <!-- End debug-panel -->

<script src="js/constants.js?v=0.9.9" defer></script>
<script src="js/state.js?v=0.9.9" defer></script>
<script src="js/utils.js?v=0.9.9" defer></script>
<script src="js/names.js?v=0.9.9" defer></script>
<script src="js/map.js?v=0.9.9" defer></script>
<script src="js/ui.js?v=0.9.9" defer></script>
  <!-- Modular game system -->
  <script src="js/game/save.js?v=0.9.9" defer></script>
  <script src="js/game/survivor.js?v=0.9.9" defer></script>
  <script src="js/game/combat.js?v=0.9.9" defer></script>
  <script src="js/game/exploration.js?v=0.9.9" defer></script>
  <script src="js/game/crafting.js?v=0.9.9" defer></script>
  <script src="js/game/expedition.js?v=0.9.9" defer></script>
  <script src="js/game/threat.js?v=0.9.9" defer></script>
  <script src="js/game/tick.js?v=0.9.9" defer></script>
  <!-- End modular game system -->
<script src="js/game/recycling.js?v=0.9.9" defer></script>
<script src="js/debug.js?v=0.9.9" defer></script>
<script src="js/main.js?v=0.9.9" defer></script>

<!-- Interactive Combat Overlay -->
<div id="combatOverlay" class="modal-overlay" style="display:none;">
  <div class="modal-card">
    <div class="modal-header">
      <strong>Engagement</strong>
    </div>
    <div id="combatContent" class="combat-grid"></div>
    <div class="combat-actions">
      <button id="btnActionShoot" class="primary">Shoot</button>
      <button id="btnActionAim">Aim</button>
      <button id="btnActionBurst">Burst</button>
      <button id="btnActionGuard">Guard</button>
      <button id="btnActionMedkit">Use Medkit</button>
      <button id="btnActionRevive" style="background:var(--success)">Revive</button>
      <button id="btnActionRetreat" class="danger">Retreat</button>
      <button id="btnActionAuto" style="margin-left:auto;">Auto-Resolve</button>
    </div>
  </div>
  
</div>

<!-- Loadout Modal -->
<div id="loadoutModal" class="modal-overlay" style="display:none;">
  <div class="modal-card" style="max-width:720px;">
    <div class="modal-header">
      <strong>Manage Loadout</strong>
      <button id="btnCloseLoadout" class="danger">‚úï</button>
    </div>
    <div id="loadoutContent"></div>
  </div>
</div>

<!-- Repair Modal -->
<div id="repairModal" class="modal-overlay" style="display:none;">
  <div class="modal-card" style="max-width:600px;">
    <div class="modal-header">
      <strong>Repair Equipment</strong>
      <button id="btnCloseRepairModal" class="danger">‚úï</button>
    </div>
    <div id="repairModalContent"></div>
  </div>
</div>

<!-- Interactive combat logic -->
<script src="js/game/combatInteractive.js?v=0.9.9" defer></script>
</body>
</html>
