<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Derelict Station — Expanded Idle</title>
  <link rel="stylesheet" href="styles.css?v=0.8.3">
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Derelict Station — Expanded Survival</h1>
      <div style="font-size:12px;color:var(--muted)">You hold a sealed base on a ruined station. Manage survivors, craft gear, face alien threats.</div>
    </div>
    <div class="flex-row">
      <div id="timePlayed" class="small">—</div>
      <button id="btnSave">Save</button>
      <button id="btnExport">Export</button>
      <button id="btnImport">Import</button>
      <input type="file" id="importFile" accept="application/json" style="display:none" />
      <button id="btnReset" class="danger">Reset</button>
    </div>
  </header>

    <main class="main-col">
    <div class="top-panels">
      <div class="panel" style="flex:1;">
        <strong style="color:var(--accent)">Base</strong>
        <div class="small">Sealed room. Keep systems online.</div>
        <div style="margin-top:8px" class="resources">
          <div class="res-item"><b id="res-oxygen">O₂: 0</b><div id="res-oxygen-rate" class="stat">—/s</div></div>
          <div class="res-item"><b id="res-food">Food: 0</b><div id="res-food-rate" class="stat">—/s</div></div>
          <div class="res-item"><b id="res-energy">Energy: 0</b><div id="res-energy-rate" class="stat">—/s</div></div>
          <div class="res-item"><b id="res-scrap">Scrap: 0</b><div id="res-scrap-rate" class="stat">—/s</div></div>
        </div>
        <div class="base-controls">
          <button id="btnAssign" class="primary">Recruit</button>
          <button id="btnExpedition">Expedition</button>
          <div id="expeditionSurvivorDropdown" class="base-controls-dropdown"></div>
        </div>
      </div>
      <div class="panel" style="width:340px;">
        <strong>Systems</strong>
        <div class="small" style="margin-top:6px">Upgrade base systems to improve production and defense.</div>
        <div style="margin-top:10px">
          <div class="stat-block"><div>O₂ Filter</div><div id="sys-filter">Level 0</div></div>
          <div class="stat-block"><div>Generator</div><div id="sys-generator">Level 0</div></div>
          <div class="stat-block"><div>Turrets</div><div id="sys-turret">Offline</div></div>
          <div style="display:flex;gap:6px;margin-top:8px">
            <button id="btnUpgradeFilter">Upgrade Filter</button>
            <button id="btnUpgradeGen">Upgrade Generator</button>
            <button id="btnBuildTurret">Build Turret</button>
          </div>
          <div id="systemRepairs" style="margin-top:8px;display:none">
            <div class="small" style="color:var(--danger);margin-bottom:6px">⚠️ Failed systems require repair:</div>
            <div style="display:flex;gap:6px;flex-wrap:wrap">
              <button id="btnRepairFilter" style="display:none">Repair Filter</button>
              <button id="btnRepairGenerator" style="display:none">Repair Generator</button>
              <button id="btnRepairTurret" style="display:none">Repair Turret</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
        <strong style="color:var(--accent)">Station Map</strong>
        <div id="explorerDropdown" style="width:180px;"></div>
      </div>
      <div class="small" style="margin-top:6px">Explore to find loot, survivors, alien nests, and modules.</div>
      <div class="map" id="mapGrid" style="margin-top:10px"></div>
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
        <div id="mapInfo" class="small">Explored: 0 • Click highlighted tiles to explore</div>
      </div>
    </div>
    <div class="bottom-panels">
      <div class="panel" style="flex:1;">
        <strong style="color:var(--accent)">Threats & Base</strong>
        <div class="small" style="margin-top:6px">Manage guard duty and defenses.</div>
        <div style="margin-top:8px">
          <div>Threat: <span id="threatLevel">Low</span></div>
          <div>Base Integrity: <span id="baseIntegrity">100%</span></div>
          <div>Raid Chance (per min): <span id="raidChance">0%</span></div>
          <div id="raidCooldownRow" class="small" style="display:none;margin-top:4px">Cooldown: <span id="raidCooldown">--:--</span></div>
        </div>
      </div>
      <div class="panel" style="width:340px;">
        <strong style="color:var(--accent)">Journal</strong>
        <div id="journal" class="small" style="margin-top:8px">Station systems nominal.</div>
      </div>
    </div>
  </main>
  <aside class="side-col">
    <div class="panel">
      <strong style="color:var(--accent)">Notifications</strong>
      <div class="log" id="log" style="margin-top:8px;max-height:150px"></div>
    </div>
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong style="color:var(--accent)">Survivors</strong><div class="small">Manage skills & assignments</div></div>
        <div id="survivorCount" class="small">0</div>
      </div>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:8px 0;">
      <div id="survivorList"></div>
    </div>
    <div class="panel">
      <strong style="color:var(--accent)">Inventory</strong> <span id="inventoryCapacity" class="small" style="color:var(--muted)"></span>
      <div class="inventory" id="inventory" style="margin-top:8px"></div>
      <div style="margin-top:8px" class="small">Tech: <span id="statTech">0</span> • Ammo: <span id="statAmmo">0</span></div>
      <div style="margin-top:10px">
        <button id="btnAutoSalvage">Salvage</button>
        <button id="btnDumpJunk">Discard</button>
      </div>
    </div>
    <div class="panel">
      <strong class="small">Workbench</strong>
      <div id="workbench" style="margin-top:6px;display:flex;flex-direction:column;gap:6px">
        <!-- Buttons dynamically rendered by renderWorkbench() in ui.js -->
      </div>
    </div>
  </aside>

  <footer>
    <div>Version 0.8.3 — Combat UI Fixes</div>
    <div>Autosave every 15s • Offline progress supported • Press Ctrl+D for debug panel</div>
  </footer>
</div>

<!-- Debug Panel -->
<div id="debugPanel" class="debug-panel" style="display:none;">
  <div class="debug-content">
    <div class="debug-header">
      <h2>Debug Panel</h2>
      <button id="btnCloseDebug" class="debug-close">✕</button>
    </div>
    
    <div class="debug-section">
      <h3>Add Resources</h3>
      <div class="debug-grid">
        <button onclick="debugAddResource('oxygen', 100)">+100 Oxygen</button>
        <button onclick="debugAddResource('food', 50)">+50 Food</button>
        <button onclick="debugAddResource('energy', 100)">+100 Energy</button>
        <button onclick="debugAddResource('scrap', 100)">+100 Scrap</button>
        <button onclick="debugAddResource('tech', 10)">+10 Tech</button>
        <button onclick="debugAddResource('ammo', 50)">+50 Ammo</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>Add Equipment</h3>
      <div class="debug-grid">
        <button onclick="debugAddItem('rifle')">Pulse Rifle</button>
        <button onclick="debugAddItem('shotgun')">Shotgun</button>
        <button onclick="debugAddItem('armor')">Light Armor</button>
        <button onclick="debugAddItem('heavyArmor')">Heavy Armor</button>
        <button onclick="debugAddItem('hazmatSuit')">Hazmat Suit</button>
        <button onclick="debugAddItem('medkit')">Medkit</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>Survivor Management</h3>
      <div class="debug-grid">
        <button onclick="debugRecruitSurvivor()">Recruit Survivor (Free)</button>
        <button onclick="debugHealAll()">Heal All Survivors</button>
        <button onclick="debugMaxMorale()">Max All Morale</button>
        <button onclick="debugLevelUp()">Level Up All Survivors</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>Map & Exploration</h3>
      <div class="debug-grid">
        <button onclick="debugRevealMap()">Reveal All Tiles</button>
        <button onclick="debugSpawnAliens()">Spawn Aliens (Random)</button>
        <button onclick="debugClearAliens()">Clear All Aliens</button>
        <button onclick="debugAddHazards()">Add Hazard Rooms</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>Systems & Base</h3>
      <div class="debug-grid">
        <button onclick="debugUpgradeSystems()">Upgrade All Systems</button>
        <button onclick="debugResetThreat()">Reset Threat</button>
        <button onclick="debugRepairBase()">Repair Base (100%)</button>
        <button onclick="debugTriggerRaid()">Trigger Raid</button>
      </div>
    </div>

    <div class="debug-section">
      <h3>Time Control</h3>
      <div class="debug-grid">
        <button onclick="debugSkipTime(60)">Skip 1 Minute</button>
        <button onclick="debugSkipTime(300)">Skip 5 Minutes</button>
        <button onclick="debugSkipTime(3600)">Skip 1 Hour</button>
      </div>
    </div>
  </div>
</div>

<script src="js/constants.js?v=0.8.3"></script>
<script src="js/state.js?v=0.8.3"></script>
<script src="js/utils.js?v=0.8.3"></script>
<script src="js/names.js?v=0.8.3"></script>
<script src="js/map.js?v=0.8.3"></script>
<script src="js/ui.js?v=0.8.3"></script>
  <!-- Modular game system -->
  <script src="js/game/save.js?v=0.8.3"></script>
  <script src="js/game/survivor.js?v=0.8.3"></script>
  <script src="js/game/combat.js?v=0.8.3"></script>
  <script src="js/game/exploration.js?v=0.8.3"></script>
  <script src="js/game/crafting.js?v=0.8.3"></script>
  <script src="js/game/expedition.js?v=0.8.3"></script>
  <script src="js/game/threat.js?v=0.8.3"></script>
  <script src="js/game/tick.js?v=0.8.3"></script>
  <!-- End modular game system -->
<script src="js/debug.js?v=0.8.3"></script>
<script src="js/main.js?v=0.8.3"></script>

<!-- Interactive Combat Overlay -->
<div id="combatOverlay" class="modal-overlay" style="display:none;">
  <div class="modal-card">
    <div class="modal-header">
      <strong>Engagement</strong>
      <button id="btnCloseCombat" class="danger">✕</button>
    </div>
    <div id="combatContent" class="combat-grid"></div>
    <div class="combat-actions">
      <button id="btnActionShoot" class="primary">Shoot</button>
      <button id="btnActionAim">Aim</button>
      <button id="btnActionBurst">Burst</button>
      <button id="btnActionGuard">Guard</button>
      <button id="btnActionMedkit">Use Medkit</button>
      <button id="btnActionRevive" style="background:var(--success)">Revive</button>
      <button id="btnActionRetreat" class="danger">Retreat</button>
      <button id="btnActionAuto" style="margin-left:auto;">Auto-Resolve</button>
    </div>
  </div>
  
</div>

<!-- Loadout Modal -->
<div id="loadoutModal" class="modal-overlay" style="display:none;">
  <div class="modal-card" style="max-width:720px;">
    <div class="modal-header">
      <strong>Manage Loadout</strong>
      <button id="btnCloseLoadout" class="danger">✕</button>
    </div>
    <div id="loadoutContent"></div>
  </div>
</div>
<!-- Interactive combat logic -->
<script src="js/game/combatInteractive.js?v=0.8.3"></script>
</body>
</html>